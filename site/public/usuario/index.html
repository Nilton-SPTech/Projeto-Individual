<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <link rel="stylesheet" href="../css/usuario/index.css">
    <link rel="stylesheet" href="../css/reset.css">
    <link rel="stylesheet" href="../css/usuario/index_main.css">
</head>
<body>
    

    <!-- ESSA DIV CRIA A MODAL INICIAL CASO O ÚSUARIO AINDA NÃO CONTENHA POKEMON -->
    <div class="div_modal" id="div_modal">
        <div class="div_escolha">
            <div class="div_card">
                <div class="div_professor"  id="div_professor">
                    <img class="img_professor" src="../assets/img_usuario/professor.png">
                    <img class="img_pokemon" id="img_pokemon" src="" >

                    <img class="img_emoji" id="img_emoji">
                </div>

                <div class="fundo_normal" id="div_pokemon" style="display: none;">
                    <div class="div_topo">
                        <div class="div_nome">
                            <div class="div_nome_especifico">
                                <span class="s_basic">Basic</span>
                                <span id="s_nome">Pikachu</span>
                            </div>
                            <div>
                                <span class="s_hp">HP</span>
                                <span id="s_vida">60</span>
                            </div>
                        </div>
                        <div class="div_imagem_pokemon">
                            <img id="img_pokemon_escolha" src="../assets/gif/pikachu-animacao.gif">
                        </div>
                    </div>
                    <div class="div_meio">
                        <div class="div_primeiro_ataque">
                            <h3 id="primeiro_ataque">Iron Tail <span>15x</span></h3>
                            <p>Esse ataque tem uma alta chance de crítico, mas um dano muito baixo.</p>
                        </div>
                        <div class="div_segundo_ataque">
                            <h3 id="segundo_ataque">Iron Secretária <span>30x</span></h3>
                            <p>Esse ataque tem um dano muito alto, mas uma chance grande de errar o alvo.</p>
                        </div>
                    </div>
                    <div class="div_baixo">
                        <div class="div_descricao">
                            <p id="descricao">Lorem ipsum dolor sit amet consectetur adipisicing elit. Magnam, molestiae culpa unde magni ab eos atque optio nostrum.</p>
                        </div>
                    </div>
                </div>

            </div>
            <div class="div_texto">
                <div class="div_esquerdo"></div>
                <div class="div_conversa" id="div_conversa"></div>
                <div class="div_direito"></div>
            </div>
        </div>
    </div>

    <!-- MAIN DA INDEX -->
    <main>

        <div class="div_trainer_card">
            <header>
                <h2 class="h2_trainer_card">TRAINER CARD</h2>
                <div class="div_identificador">
                    <h3>ID: <span id="s_id"></span></h3>
                </div>
            </header>
            <div class="div_informacao_usuario">
                <div class="div_dados">
                    <div class="div_nome_usuario">
                        <h2>NOME: <span id="s_nome_usuario"></span></h2>
                    </div>
                    <div class="div_dados_usuario">
                        <h2>PONTOS <span id="s_pontos"></span></h2>
                        <h2>POKÉDEX <span id="s_pokedex"></span></h2>
                        <h2>PAÍS <span id="s_pais"></span></h2>
                    </div>

                </div>
                <div class="div_img_personagem">
                    <div class="div_chao">
                        <img id="img_usuario">
                    </div>
                </div>
            </div>
    
            <footer>
                <h3>Seus Pokemons</h3>
                <div class="div_pokemons">
                    <div class="div_pokemon" id="pokemon1" onclick="div_pokemon_grande(1)"> </div>

                    <!-- div_pokemon_grande -->
                    <div class="div_pokemon" id="pokemon2" onclick="div_pokemon_grande(2)"></div>
                    <div class="div_pokemon" id="pokemon3" onclick="div_pokemon_grande(3)"></div>
                    <div class="div_pokemon" id="pokemon4" onclick="div_pokemon_grande(4)"></div>
                    <div class="div_pokemon" id="pokemon5" onclick="div_pokemon_grande(5)"></div>
                    <div class="div_pokemon" id="pokemon6" onclick="div_pokemon_grande(6)"></div>
                </div>
            </footer>
        </div>
    </main>

    <div id="div_fundo_preto"></div>

    <div class="div_compra_pokemon" id="div_compra_pokemon">
        <div class="div_pontos_usuario">
            <span>Seus pontos:</span>
            <span id="s_pontos_usuario"></span>
        </div>
        <div class="div_fechar_modal_compra" onclick="fechar_compra()">
            <img src="https://i.pinimg.com/originals/b4/6b/ec/b46bec8fc5ba7833c719dfe3156e0615.png">
        </div>
        <div class="div_titulo_bloqueado">
            <h2>Esse pokémon está bloquado</h2>
        </div>
        <div class="div_pokemon_bloqueado">
            <img id="img_pokemon_bloqueado">
        </div>
        <div class="div_informacao_pokemon_bloqueado">

            <h3>Nome: ??????</h3>
            <h3>Tipo: ????? / ?????</h3>
            <h3>Descrição: ???</h3>

            <h2 class="h2_descricao_compra">Valor de compra</h2>
            <h3 class="h3_pontos" id="h3_compra">
                <span id="s_pontos_compra">250</span>
                Pontos
            </h3>
            <button onclick="comprar_pokemon()">Comprar</button>

        </div>


    </div>




</body>
</html>
<script src="../js/funcao_listar_pokemon.js"></script>


<script>


    // POKEMON PROFESSOR 
    img_pokemon.src = `../assets/gif/${sessionStorage.POKEMON}-animacao.gif`

    validar_pokemon()
    var nome = sessionStorage.NOME_USUARIO

    // VETOR COM OS TEXTOS QUE VÃO APARECER NA TELA
    var vetor = [
        `Olá mestre Pokemon ${nome}!`,
        'Prazer em te conhecer, eu me chamo Professor Carvalho, e eu serei o seu guia nessa grande jornada. ',
        `proximo`, 
        `O mundo Pokemon é repleto de maravilhas e curiosidades, seus monstrinhos de bolso vão te auxiliar durante as batalhas.`,
        `Acumule pontos batalhando e chegue mais próximo do sonho de se tornar o maior mestre Pokemon.`,
        `proximo`,
        `Está preparado para viver essa aventura?`,
        `pergunta`,
        `Ótimo! Então eu irei te ajudar a escolher seu companheiro nessa grande jornada.`, 
        `Hehe, fique tranquilo. Eu sempre estarei  do seu lado caso precise de uma luz, agora vamos escolher seu companheiro para essa grande jornada.`,
        `proximo`,
        `Escolha somente um dentre os três para ser seu companheiro:`, 
        'opcao',
        ``,
        'fim', 
    ]
    
    var j = 0

    // FUNÇÃO PARA VALIDAR SE O USUARIO TEM POKEMON
    // SE ELE NÃO TIVER POKEMON CADASTRADO NÃO APARECE A MODAL COM AS OPÇÕES 
    function validar_pokemon(){
        fetch(`/usuarios/listar_pokemon_usuario/${sessionStorage.ID_USUARIO}`, {
            method: "GET", 
            headers: {
                "Content-Type": "application/json"
            }
        })
        .then(function (resposta){
            console.log("Entramos no THEN")
            if(resposta.ok){
                resposta.json().then(function (response){
                    if(response.length < 1){
                        aparecer_modal()                    }
                    else{
                        fim()
                    }
                })
            }
            else{
                console.log("Nenhum dado encontrado ou erro na API")
            }
        })
        .catch(function (error){
            console.error(`Erro na obtençãp dos dados: ${error.messasge}`)
        })
     
    }

    // FUNÇÃO PARA MOSTRAR O TEXTO NA TELA
    function texto(){
        
        div_conversa.innerHTML = ""

        if(j == 11){
            img_emoji.classList.toggle('aparecer_img_emoji')
        }

        var i = 0
        var palavra = setInterval(() => {
       
            // MOSTRANDO AS FRASES QUE NÃO SÃO 'proximo'
            if(vetor[j] != "proximo"){
                div_conversa.innerHTML += vetor[j][i] 
                
                i++
                var validar_tamanho = i == vetor[j].length 
                if(validar_tamanho){
                    i = 0
                    j++
                    console.log("Chegamos no fim")
                }
            }

            // APARECENDO A IMAGEM DO POKEMON NO BLOCO 2
            if(j == 3){
                img_pokemon.classList.toggle('aparecer_imagem_pokemon')
            }
            if(j == 6){
                img_pokemon.classList.toggle('aparecer_imagem_pokemon')
            }
            
            // VALIDANDO SE O CONTEUDO DO ARRAY É 'pergunta'
            var validar_pergunta = vetor[j] == "pergunta"
            if(validar_pergunta){
                clearInterval(palavra)
                j++
                div_conversa.innerHTML += `<br>
                <div class="div_pergunta">
                    <button onclick="pergunta('sim')">Sim</button>
                    <button onclick="pergunta('nao')">Não</button>
                </div>
                `
            }

            var validar_opcao = vetor[j] == "opcao"
            var opcao_verdadeiro = false
            if(validar_opcao){
                j++
                opcao()
                clearInterval(palavra)
                opcao_verdadeiro = true
            }

            var validar_fim = vetor[j] == "fim"
            if(validar_fim){
                clearInterval(palavra)
                opcao_verdadeiro = true

                div_conversa.innerHTML += `<br><br><button class="button_fim" onclick="fim()">Finalizar</button>`
            }

            //VALIDANDO SE O CONTEUDO DO ARRAY É 'proximo'
            var validar_proximo = vetor[j] == "proximo" && !opcao_verdadeiro
            if(validar_proximo){
                clearInterval(palavra)
                j++
                div_conversa.innerHTML += `<br><button onclick="texto()">Prosseguir</button>`
            }
            
            // DANDO ESPAÇAMENTO CASO O CONTEUDO NÃO SEJA 'proximo' E validar_tamanho FOR VERDADEIRO
            if(!validar_proximo && validar_tamanho){
                div_conversa.innerHTML += '<br><br>'
            }
        }, 60)
    }

    // DANDO O SRC DO EMOJI
    var src_emoji = "../assets/img_usuario/"
    function pergunta(resposta){
        div_conversa.innerHTML = ""
        var i = 0

        // OPERADOR TERNÁRIO PARA VALIDAR SE A RESPOSTA É 'sim' OU 'nao'
        j = resposta == 'sim' ? 8 : 9
        // OPERADOR TERNARIO PARA VALIDAR SE O j ESTÁ NA POCIÇÃO 8 OU 9
        src_emoji += j == 8 ? "feliz_emoji.png" : "alivio_emoji.png"
        // PASSANDO O SRC PARA DENTRO DA IMG
        img_emoji.src = src_emoji
        // MOSTRANDO A IMG NA TELA
        img_emoji.classList.toggle('aparecer_img_emoji')

        // LAÇO DE REPETIÇÃO COM INTERVALO PARA PERCORRER AS FRASES
        var frase = setInterval(() => {
            if(vetor[j] != "proximo"){
                div_conversa.innerHTML += vetor[j][i] 
                
                i++
                var validar_tamanho = i == vetor[j].length 

                if(validar_tamanho){
                    // OPERADOR TERNARIO PARA VALIDAR SE O j ESTÁ NA POSIÇÃO 8 OU 9
                    j = j == 8 ? 10 : j + 1
                    i = 0
                    console.log("Chegamos no fim")
                }
            }
            if(j == 10){
                clearInterval(frase)
                j++
                div_conversa.innerHTML += `<br><button onclick="texto()">Prosseguir</button>`
            }
        }, 60)
    }

    // FUNÇÕES opcao() SÃO AS FUNÇÕES QUE VÃO MOSTRAR PARA O USER OS POKEMON
    function opcao_fim(){
        div_professor.style.display = 'flex'
        div_pokemon.style.display = 'none'
    }
    
    function opcao(){

        div_professor.style.display = 'none'
        div_pokemon.style.display = 'block'

        div_conversa.innerHTML += `
        <form class="div_pokemon_opcao" id="form_pokemon_opcao">
            <div class="div_pokemon_especifico">
                <h3 id="h3_nome">Charmander</h3>
                <div class="div_img_pokemon">
                    <img src="../assets/pokemon/charmander-frente.png"> 
                </div>
                <input type="radio" id="in_charmander" name="pokemon" onclick=" selecionar('Charmander')">
            </div>
            <div class="div_pokemon_especifico">
                <h3 id="h3_nome">Squirtle</h3>
                <div class="div_img_pokemon">
                    <img src="../assets/pokemon/squirtle-frente.png"> 
                </div>
                <input type="radio" id="in_charmander" name="pokemon" onclick=" selecionar('Squirtle')">
            </div>
            <div class="div_pokemon_especifico">
                <h3 id="h3_nome">Bulbasaur</h3>
                <div class="div_img_pokemon">
                    <img src="../assets/pokemon/bulbassaur-frente.png"> 
                </div>
                <input type="radio" id="in_charmander" name="pokemon" onclick=" selecionar('Bulbasaur')">
            </div>
        </form>    
        <br>
        <button onclick="cadastrar_pokemon()">Selecionar Pokemon</button>
        `
    }

    //PUXA OS VALORES DO BANCO PARA MOSTRAR O POKEMON
    function selecionar(nome){
        fetch("/pokemons/listar_pokemon", {cache: 'no-store'})
        .then(function (response){
            if(response.ok){
                response.json().then(function (resposta){
                    listar_opcao(resposta, nome)
                })
            }
            else{
                console.log("Nenhuma dado encontrado ou erro na API")
            }
        })
        .catch(function(error){
            console.log(`Erro na obtenção dos dados do select: ${error.message}`)
        })
    }

    //VARIAVEL PARA PUXAR O IDENTIFICADOR DO POKEMON
    var id_pokemon

    //ESSA FUNÃO LISTA AS INFORMAÇÕES DO POKEMON NO CARD
    function listar_opcao(pokemons, nome){
        var vetor_pokemon = []

        for(var i = 0; i < pokemons.length; i++){
            var pokemon = pokemons[i]
            if(pokemon.nome == nome){
                vetor_pokemon.push(pokemon)
            }
        }

        // ADICIONANDO AS VARIAVEIS
        id_pokemon = vetor_pokemon[0].idPokemon
        sessionStorage.NOME_POKEMON = vetor_pokemon[0].nome

        // ADICIONANDO NA TELA DO USUARIO
        s_nome.innerHTML = vetor_pokemon[0].nome
        s_vida.innerHTML = vetor_pokemon[0].vidaTotal
        primeiro_ataque.innerHTML = vetor_pokemon[0].ataqueFraco
        segundo_ataque.innerHTML = vetor_pokemon[0].ataqueForte
        descricao.innerHTML = vetor_pokemon[0].descricao
        img_pokemon_escolha.src = `../assets/gif/${vetor_pokemon[0].enderecoGif}`

        vetor[13] = `Ótima escolha, agora o ${vetor_pokemon[0].nome} será seu novo companheiro nas batalhas, eu espero que você se divirta durante sua jornada. BOA SORTE ${sessionStorage.NOME_USUARIO}!!!`

        div_pokemon.classList.remove('fundo_normal')

        if(nome == 'Charmander'){
            div_pokemon.classList.add('fundo_fogo')
            div_pokemon.classList.remove('fundo_agua')
            div_pokemon.classList.remove('fundo_grama')
        }

        if(nome == 'Squirtle'){
            div_pokemon.classList.remove('fundo_fogo')
            div_pokemon.classList.add('fundo_agua')
            div_pokemon.classList.remove('fundo_grama')
        }

        if(nome == 'Bulbasaur'){
            div_pokemon.classList.remove('fundo_fogo')
            div_pokemon.classList.remove('fundo_agua')
            div_pokemon.classList.add('fundo_grama')
        }
    }

    //CADASTRANDO O POKEMON DO USUARIO
    function cadastrar_pokemon(){
        console.log(id_pokemon)

        var id_usuario = sessionStorage.ID_USUARIO

        if(id_pokemon != undefined){
            fetch("/pokemons/cadastrar_pokemon_usuario", {
                method: "POST", 
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify({
                    usuarioServer: id_usuario, 
                    pokemonServer: id_pokemon
                })
            })
            .then(function (resposta){
                console.log("resposta ", resposta)
    
                if(resposta.ok){
                    console.log("cadastro feito com sucesso")

                    opcao_fim()
                    texto()
                }
                else{
                    throw("Houve um erro ao tentar realizar o cadastro")
                }
            })
            .catch(function(resposta){
                console.log(`#ERRO: ${resposta}`)
            })
        }
        else{
            alert("Selecione um pokemon")
        }
    }

    //FINZALIZANDO A MODAL
    function fim(){
        div_modal.style.display = 'none'
        listar_usuario()
    }

    function aparecer_modal(){
        div_modal.style.display = 'flex'
        texto()
    }
</script>

<script>

    listar_usuario()
    var id = sessionStorage.ID_USUARIO
    function listar_usuario(){
        fetch(`/usuarios/listar_usuario/${id}`, {
            method: "GET", 
            headers: {
                "Content-Type": "application/json"
            }
        })
        .then(function (response){
            if(response.ok){
                response.json().then(function (resposta){
                    mostrar_select(resposta)
                    listar_pokedex()
                    listar_todos_pokemons()
                })
            }
            else{
                console.log("ERRO")
            }
        })
        .catch(function (error){
            console.error(`Erro na obtenção dos dados. Erro : ${error.message}`)
        })
    }

    var pontos_usuario = 0
    function mostrar_select(dados){
        var usuario = dados 
        s_id.innerHTML = usuario[0].idUsuario
        s_nome_usuario.innerHTML = usuario[0].nome

        pontos_usuario = usuario[0].pontos
        s_pontos.innerHTML = pontos_usuario

        s_pais.innerHTML = usuario[0].pais
        img_usuario.src = `../assets/personagens/${usuario[0].imgUsuario}`
    }

    function listar_pokedex(){
        fetch(`/usuarios/count_pokemon/${id}`, {
            method: "GET", 
            headers: {
                "Content-Type": "application/json"
            }
        })
        .then(function (response){
            if(response.ok){
                response.json().then(function (resposta){
                    s_pokedex.innerHTML = resposta[0].pokedex
                })
            }
            else{
                console.log("ERRO")
            }
        })
        .catch(function (error){
            console.error(`Erro na obtenção dos dados. Erro : ${error.message}`)
        })
    }


    function listar_pokemons(){
        fetch(`/pokemons/listar_pokemon_usuario/${id}`, {
            method: "GET", 
            headers: {
                "Content-Type": "application/json"
            }
        })
        .then(function (response){
            if(response.ok){
                response.json().then(function (resposta){
                    mostrar_pokemon(resposta)
                })
            }
            else{
                console.log("ERRO")
            }
        })
        .catch(function (error){
            console.error(`Erro na obtenção dos dados. Erro : ${error.message}`)
        })
    }

    function mostrar_pokemon(dado){
        for(var i = 0; i < dado.length; i++){
            // VALIDANDO SE O USUARIO TEM AQUELES POKEMONS
            for(var j = 0; j < imagens.length; j++){
                if(dado[i].idPokemon == imagens[j].id){
                    imagens[j].status = true
                }
            }
        }
    }


    function listar_todos_pokemons(){
        fetch("/pokemons/listar_pokemon", {
            method: "GET", 
            cache: 'no-store'
        }).then(function(response){
            if(response.ok){
                response.json().then(function (resposta){
                    listar_div(resposta)
                })
            }
            else{
                console.log("Nenhum dado encontrado ou erro na API")
            }
        })
        .catch(function(error){
            console.error(`Erro na obtenção dos dados p/ tabelas: ${error.message}`)
        })
    }


    var imagens = []
    function listar_div(dado){
        for(var i = 0; i < dado.length; i++){
            var pokemon = dado[i]

            var imagem_pokemon = {
            id: pokemon.idPokemon, 
            img: `../assets/pokemon/${pokemon.enderecoImagemFrente}`, 
            status: false 
            }  
            imagens.push(imagem_pokemon)
        }
        listar_pokemons()
        setTimeout(() => {
            pokemon_default()
        }, 500);
    }
    
    
    function pokemon_default(){

        console.log(imagens[1].status)

        pokemon1.style.backgroundImage = `url(${imagens[0].img})`
        if(imagens[0].status){
            pokemon1.style.filter = "none"
        }

        pokemon2.style.backgroundImage = `url(${imagens[1].img})`
        if(imagens[1].status){
            pokemon2.style.filter = "none"
        }

        pokemon3.style.backgroundImage = `url(${imagens[2].img})`
        if(imagens[2].status){
            pokemon3.style.filter = "none"
        }

        pokemon4.style.backgroundImage = `url(${imagens[3].img})`
        if(imagens[3].status){
            pokemon4.style.filter = "none"
        }

        pokemon5.style.backgroundImage = `url(${imagens[4].img})`
        if(imagens[4].status){
            pokemon5.style.filter = "none"
        }

        pokemon6.style.backgroundImage = `url(${imagens[5].img})`
        if(imagens[5].status){
            pokemon6.style.filter = "none"
        }
    
    }


   
</script>

<script>

    var div_pokemon_atual = ''
    function div_pokemon_grande(id){
        var img = ''
        var filtro = ''
        switch (id) {
            case 1: 
                img = pokemon1.style.backgroundImage
                div_pokemon_atual = pokemon1
                filtro = pokemon1.style.filter
            break;
        
            case 2: 
                img = pokemon2.style.backgroundImage
                div_pokemon_atual = pokemon2
                filtro = pokemon2.style.filter
            break;

            case 3: 
                img = pokemon3.style.backgroundImage
                div_pokemon_atual = pokemon3
                filtro = pokemon3.style.filter
            break;

            case 4: 
                img = pokemon4.style.backgroundImage
                div_pokemon_atual = pokemon4
                filtro = pokemon4.style.filter
            break;

            case 5: 
                img = pokemon5.style.backgroundImage
                div_pokemon_atual = pokemon5
                filtro = pokemon5.style.filter
            break;
            default:
                img = pokemon6.style.backgroundImage
                div_pokemon_atual = pokemon6
                filtro = pokemon6.style.filter
            break;
        }


        img = img.replaceAll(`url("../assets/pokemon/`, '')
        img = img.replaceAll(`url("`, '')
        img = img.replaceAll(`")`, '')

        if(filtro == "none"){
            listar_informacao_pokemon(img)
        }else{
            listar_informacao_pokemon_default(img)
            console.log(img)
        }
    }

    function listar_informacao_pokemon(img){
        var usuarioVar = sessionStorage.ID_USUARIO
        var imgVar = img
        
        fetch("/pokemons/listar_informacao_pokemon", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                usuarioServer: usuarioVar,
                imgServer: imgVar
            })
        }).then(function (resposta) {
            if (resposta.ok) {
                resposta.json().then(json => {
                    guardar_informacao_div(json)

                });
            } else {
                console.log("Houve um erro ao tentar pegar o pokemon");
            }
        }).catch(function (erro) {
            console.log(erro);
        })
    }

    var validar = false 
    function guardar_informacao_div(dado){
        
        if(dado == undefined){
            fechar_informacao()
            validar = true
        }
        else{
            var pokemon = dado[0]
            var contem_class = div_pokemon_atual.classList[1] == undefined
            if(contem_class){
                informacao_pokemon = 
                    `
                    <div class="fechar_informacao" >
                        <img onclick="guardar_informacao_div()" src="https://i.pinimg.com/originals/b4/6b/ec/b46bec8fc5ba7833c719dfe3156e0615.png">
                    </div>
                    <div class="div_informacao_pokemon">
                        <div class="div_nome_level">
                            <h2>${pokemon.nome}</h2>
                            <div class="div_level">
                                <span>Lv</span>
                                <span>${Number(pokemon.levelPokemon)}</span>
                            </div>
                        </div>
                        <div class="div_pontos_vida">
                            <h2>Vida: <span>${pokemon.vidaTotal}</span></h2>
                        </div>

                        <h3 class="h3_ataques">Ataques:</h3>
                        <div class="div_ataques">
                            <div>
                                <h3>${pokemon.ataqueFraco}</h3>
                                <h3>Cura</h3>
                            </div>
                            <div>
                                <h3>Defesa</h3>
                                <h3>${pokemon.ataqueForte}</h3>
                            </div>
                        </div>

                        <div class="div_descricao_pokemon">
                            <p>${pokemon.descricao}</p>
                        </div>
                    </div>
                    <button onclick="batalhar(${pokemon.idPokemon})">Batalhar</button>
                    `

                if(!validar){

                    div_fundo_preto.classList.add('div_fundo_preto_ativo')
                    div_pokemon_atual.classList.add('div_pokemon_grande')
    
                    setTimeout(() => {
                        div_pokemon_atual.innerHTML = informacao_pokemon
                    }, 500);
                }
            }
        }
    }


    function listar_informacao_pokemon_default(img){
        fetch(`/pokemons/pegar_idPokemon/${img}`)
            .then(function (resposta){
                if(resposta.ok){
                    resposta.json().then(response =>{
                        console.log(response)
                        modal_compra(response)
                    })
                }
                else{
                    console.log(resposta);
                }
            })
    }

    var valor_compra = 0
    var id_pokemon_compra 
    function modal_compra(pokemon){
        div_fundo_preto.classList.add("div_fundo_preto_ativo")
        div_compra_pokemon.style.display = "flex"

        id_pokemon_compra = pokemon[0].idPokemon
        valor_compra = (pokemon[0].descricao.length) * 6

        if(valor_compra > pontos_usuario){
            var cor = '#B21E1E'
            h3_compra.style.color = cor
        }
        s_pontos_compra.innerHTML = valor_compra
        
        img_pokemon_bloqueado.src = `../assets/gif/${pokemon[0].enderecoGif}`
        s_pontos_usuario.innerHTML = pontos_usuario
    }

    function fechar_compra(){
        div_fundo_preto.classList.remove("div_fundo_preto_ativo")
        div_compra_pokemon.style.display = "none"
    }

    function comprar_pokemon(){
        if(pontos_usuario >= valor_compra){
            fetch("/pokemons/cadastrar_pokemon_usuario", {
                method: "POST", 
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify({
                    usuarioServer: sessionStorage.ID_USUARIO, 
                    pokemonServer: id_pokemon_compra
                })
            })
            .then(function (resposta){    
                if(resposta.ok){
                    update_pontos(valor_compra)
                }
            })
            .catch(function(resposta){
                console.log(`#ERRO: ${resposta}`)
            })
        }
    }

    function update_pontos(valor_compra){
        fetch("/usuarios/update_pontos", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({
                usuarioServer: sessionStorage.ID_USUARIO, 
                pontosServer: valor_compra
            })
        })
        .then(function (resposta){
            if(resposta.ok){
                fechar_compra()
                listar_usuario()
            }
        })
    }


    function batalhar(idPokemon){

        sessionStorage.ID_POKEMON = idPokemon

        window.location = "./batalha_pokemon.html"
    }

    function fechar_informacao(){
        div_pokemon_atual.innerHTML = ''
        
        div_fundo_preto.classList.remove('div_fundo_preto_ativo')
        div_pokemon_atual.classList.remove('div_pokemon_grande')

        setTimeout(() => {
            validar = false
        }, 500);
    }




</script>